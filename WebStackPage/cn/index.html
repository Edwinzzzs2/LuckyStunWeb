<!DOCTYPE html>
<html lang="zh">

<head>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?c05bb16ea908292af9f6c513087a1cc3";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="viggo" />
    <title>Web导航</title>
    <meta name="keywords"
        content="UI设计,UI设计素材,设计导航,网址导航,设计资源,创意导航,创意网站导航,设计师网址大全,设计素材大全,设计师导航,UI设计资源,优秀UI设计欣赏,设计师导航,设计师网址大全,设计师网址导航,产品经理网址导航,交互设计师网址导航,www.webstack.cc">
    <meta name="description" content="WebStack - 收集国内外优秀设计网站、UI设计资源网站、灵感创意网站、素材资源网站，定时更新分享优质产品设计书签。www.webstack.cc">
    <link rel="shortcut icon" href="../assets/images/favicon.png">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Web导航">
    <link rel="apple-touch-icon" href="../assets/images/icons/icon-152x152.png">
    <link rel="stylesheet" href="../assets/css/fonts/linecons/css/linecons.css">
    <link rel="stylesheet" href="../assets/css/fonts/fontawesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/xenon-core.css">
    <link rel="stylesheet" href="../assets/css/xenon-components.css">
    <link rel="stylesheet" href="../assets/css/xenon-skins.css">
    <link rel="stylesheet" href="../assets/css/nav.css">
    <script src="../assets/js/jquery-1.11.1.min.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta property="og:type" content="article">
    <script>
        // 检查浏览器是否支持Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker 注册成功: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker 注册失败: ', error);
                    });
            });
        }
    </script>
    <style>
        /* URL 显示样式 */
       
    </style>
</head>

<body class="page-body">
    <!-- skin-white -->
    <div class="page-container">
        <div class="sidebar-menu toggle-others fixed">
            <div class="sidebar-menu-inner">
                <header class="logo-env">
                    <!-- logo -->
                    <div class="logo">
                        <a href="index.html" class="logo-expanded">
                            <img src="../assets/images/logo@2x.png" width="100%" alt="" />
                        </a>
                        <a href="index.html" class="logo-collapsed">
                            <img src="../assets/images/logo-collapsed@2x.png" width="40" alt="" />
                        </a>
                    </div>
                    <div class="mobile-menu-toggle visible-xs">
                        <a href="#" data-toggle="user-info-menu">
                            <i class="linecons-cog"></i>
                        </a>
                        <a href="#" data-toggle="mobile-menu">
                            <i class="fa-bars"></i>
                        </a>
                    </div>
                </header>
                <!-- 左侧菜单占位符 -->
                <ul id="main-menu" class="main-menu">
                    <!-- 由 JS 动态生成 -->
                </ul>
            </div>
        </div>
        <div class="main-content">
            <nav class="navbar user-info-navbar" role="navigation">
                <!-- User Info, Notifications and Menu Bar -->
                <!-- Left links for user info navbar -->
                <ul class="user-info-menu left-links list-inline list-unstyled">
                    <li class="hidden-sm hidden-xs">
                        <a href="#" data-toggle="sidebar">
                            <i class="fa-bars"></i>
                            <!-- <i class="fa-google"></i> -->
                        </a>
                    </li>
                    <li class="dropdown hover-line language-switcher">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="dropdown-toggle">
                            <img src="../assets/images/flags/flag-cn.png" alt="flag-cn" /> <span id="current-network-type">外网</span>
                        </a>
                        <ul class="dropdown-menu languages">
                            <li id="li-main">
                                <a href="#" onclick="switchNetworkType('main'); return false;">
                                    <img src="../assets/images/flags/flag-cn.png" alt="flag-cn" /> 外网
                                </a>
                            </li>
                            <li id="li-internal">
                                <a href="#" onclick="switchNetworkType('internal'); return false;">
                                    <img src="../assets/images/flags/flag-cn.png" alt="flag-cn" /> 内网
                                </a>
                            </li>
                            <li id="li-backup">
                                <a href="#" onclick="switchNetworkType('backup'); return false;">
                                    <img src="../assets/images/flags/flag-cn.png" alt="flag-cn" /> 备用
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="user-info-menu right-links list-inline list-unstyled">
                    <li class="hidden-sm hidden-xs">
                        <a href="https://github.com/Edwinzzzs2/luckyStunWeb" target="_blank">
                            <i class="fa-github"></i> GitHub
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- 主内容占位符 -->
            <div id="main-content-wrapper">
                <!-- 由 JS 动态生成 -->
            </div>

            <!-- Main Footer -->
            <!-- Choose between footer styles: "footer-type-1" or "footer-type-2" -->
            <!-- Add class "sticky" to  always stick the footer to the end of page (if page contents is small) -->
            <!-- Or class "fixed" to  always fix the footer to the end of page -->
            <footer class="main-footer sticky footer-type-1">
                <div class="footer-inner">
                    <!-- Add your copyright text here -->
                    <div class="footer-text">
                        &copy; 2017-2025 <!-- 修改年份 -->
                        <a href="../cn/about.html"><strong>WebStack</strong></a> modify by <a
                            href="#" target="_blank"><strong>Edwin</strong></a>
                    </div>
                    <!-- Go to Top Link, just add rel="go-top" to any link to add this functionality -->
                    <div class="go-up">
                        <a href="#" rel="go-top">
                            <i class="fa-angle-up"></i>
                        </a>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <!-- 锚点平滑移动 -->
    <script type="text/javascript">
        // 原有的平滑滚动和菜单交互逻辑保持不变
        $(document).ready(function () {
            //img lazy loaded
            const observer = lozad(); // Initialize Lozad
            // observer.observe(); // Observe after content is generated

            $('.user-info-menu .hidden-sm').click(function () {
                if ($('.sidebar-menu').hasClass('collapsed')) {
                    $('.has-sub.expanded > ul').attr("style", "")
                } else {
                    $('.has-sub.expanded > ul').show()
                }
            })
            // Modified selector for dynamic content
            $(document).on('click', "#main-menu li ul li", function () {
                $(this).siblings('li').removeClass('active'); // 删除其他兄弟元素的样式
                $(this).addClass('active'); // 添加当前元素的样式
            });
            // Modified selector for dynamic content
            $(document).on('click', "a.smooth", function (ev) {
                ev.preventDefault();

                // Smooth scrolling logic
                var targetId = $(this).attr("href");
                // Ensure the target element exists before trying to scroll
                if ($(targetId).length) {
                    public_vars.$mainMenu.add(public_vars.$sidebarProfile).toggleClass('mobile-is-visible');
                    ps_destroy(); // Assuming this function exists and handles PerfectScrollbar
                    $("html, body").animate({
                        scrollTop: $(targetId).offset().top - 30
                    }, {
                        duration: 500,
                        easing: "swing"
                    });
                } else {
                    console.warn("Smooth scroll target not found:", targetId);
                }


                // Update active class for sidebar items
                $("#main-menu li").removeClass("active").removeClass("expanded").removeClass("opened"); // Reset all
                $(this).closest('li').addClass('active');

                // Handle parent menu item expansion and active state
                if ($(this).closest('ul').hasClass('sub-menu')) {
                    var parentLi = $(this).closest('li.has-sub');
                    parentLi.addClass('active').addClass('expanded').addClass('opened');
                    // Ensure parent ul is visible if menu is collapsed
                    if ($('.sidebar-menu').hasClass('collapsed')) {
                        parentLi.children('ul').show();
                    }
                } else {
                    $(this).closest('li').addClass('active');
                }


            });
            // Removed the old scroll position logic as it's handled within the click event now

            // --- Data Loading and Rendering ---
            // 使用API获取数据
             fetch('/api/navigation')
            //    fetch('http://192.168.31.26:3602/api/navigation')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('网络请求失败: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('从API获取的数据:', data);
                    generateSidebarMenu(data);
                    generateMainContent(data);
                    
                    // 关键：确保这一部分存在且没有被注释掉
                    if (typeof setup_sidebar_menu === 'function') {
                       setup_sidebar_menu(); // 重新初始化侧边栏
                    } else {
                       console.warn('setup_sidebar_menu 函数未找到，请检查 xenon-custom.js');
                    }

                    // Observe images after content is generated
                    observer.observe();

                    // 重新初始化相关插件
                    if (window.xenonCustom && typeof window.xenonCustom.refresh === 'function') {
                        window.xenonCustom.refresh();
                    }

                    // --- 添加窗口大小调整监听器 ---
                    var handleResize = debounce(function() {
                        console.log('Window resized, refreshing Xenon layout...');
                        if (window.xenonCustom && typeof window.xenonCustom.refresh === 'function') {
                            window.xenonCustom.refresh();
                        }
                        // 可选：如果 refresh 不够，可能需要重新调用 setup_sidebar_menu
                        // 但要注意潜在的事件重复绑定风险
                        // if (typeof setup_sidebar_menu === 'function') {
                        //    setup_sidebar_menu();
                        // }
                    }, 250); // 250ms 的防抖延迟

                    $(window).on('resize', handleResize);
                    // --- 结束添加监听器 ---

                })
                .catch(error => {
                    console.error('加载或处理数据时出错:', error);
                    $('#main-menu').html('<li><a href="#"><i class="linecons-alert"></i><span class="title">加载菜单失败</span></a></li>');
                    $('#main-content-wrapper').html('<p class="text-danger">加载内容失败: ' + error.message + '</p>');
                });
        }); // End document ready

        // --- Generation Functions ---

        function generateSidebarMenu(data) {
            const menuUl = $('#main-menu');
            let menuHtml = '';

            data.forEach(category => {
                if (category.children && category.children.length > 0) {
                    // Category with sub-menu
                    menuHtml += `<li class="has-sub">`;
                    menuHtml += `<a><i class="${category.icon}"></i><span class="title">${category.name}</span></a>`;
                    menuHtml += `<ul class="sub-menu">`; // Add sub-menu class
                    category.children.forEach(child => {
                        menuHtml += `<li>`;
                        menuHtml += `<a href="#${child.name}" class="smooth"><span class="title">${child.name}</span>`;
                        if (child.is_hot) {
                            menuHtml += `<span class="label label-pink pull-right hidden-collapsed">Hot</span>`;
                        }
                        menuHtml += `</a></li>`;
                    });
                    menuHtml += `</ul></li>`;
                } else if (category.web && category.web.length > 0) {
                    // Top-level category without sub-menu
                    menuHtml += `<li>`;
                    menuHtml += `<a href="#${category.name}" class="smooth"><i class="${category.icon}"></i><span class="title">${category.name}</span></a>`;
                    menuHtml += `</li>`;
                }
                // Add other top-level items like "About" if they are not in JSON
            });
            // Manually add the "About" link if it's not in the JSON data
            menuHtml += `
                <li>
                    <a href="about.html">
                        <i class="linecons-heart"></i>
                        <span class="tooltip-blue">关于本站</span>
                        <span class="label label-Primary pull-right hidden-collapsed">♥︎</span>
                    </a>
                </li>`;


            menuUl.html(menuHtml);
            // Important: Re-run Xenon's sidebar setup after adding items
            // setup_sidebar_menu(); // Or the relevant function from xenon-custom.js
        }

        function generateMainContent(data) {
            const contentWrapper = $('#main-content-wrapper');
            let contentHtml = '';

            data.forEach(category => {
                // --- Generate Category/SubCategory Blocks ---
                if (category.children && category.children.length > 0) {
                    // Category with children - Iterate through children
                    category.children.forEach(child => {
                        contentHtml += generateCategorySection(child.name, child.icon || category.icon, child.web); // Use child icon or parent icon
                    });
                } else if (category.web && category.web.length > 0) {
                    // Top-level category with websites
                    contentHtml += generateCategorySection(category.name, category.icon, category.web);
                }
            });

            contentWrapper.html(contentHtml);
        }

        function generateCategorySection(categoryName, categoryIcon, websites) {
            if (!websites || websites.length === 0) return '';

            const lskyInternalBase = 'lsky'; // Lsky 内网基础地址

            let sectionHtml = `<h4 class="text-gray"><i class="${categoryIcon}" style="margin-right: 7px;" id="${categoryName}"></i>${categoryName}</h4>`;
            sectionHtml += '<div class="row">'; // Start the first row

            websites.forEach((site, index) => {
                // Close and start a new row every 4 items (except the first)
                if (index > 0 && index % 4 === 0) {
                    sectionHtml += '</div><div class="row">';
                }

                let logoSrc = site.logo;
                if (logoSrc && logoSrc.includes(lskyInternalBase)) { // 如果是内网 Lsky 地址，替换为反向代理路径
                    try {
                        logoSrc = new URL(logoSrc);
                    } catch (e) {
                        console.error("Error parsing Lsky URL:", logoSrc, e);
                    }

                } else if (logoSrc && !logoSrc.startsWith('http')) { // 如果不是 http 开头，则认为是相对于当前目录的父目录的相对路径
                    logoSrc = '../' + logoSrc;
                }
                // 如果已经是其他 http/https 地址 (非内网Lsky)，则保持不变

                // 根据 URL 类型选择合适的 URL
                let targetUrl = site.url;
                const urlType = getStoredUrlType();
                
                if (urlType === 'backup' && site.backup_url) {
                    targetUrl = site.backup_url;
                } else if (urlType === 'internal' && site.internal_url) {
                    targetUrl = site.internal_url;
                }

                // 更新网站链接的显示
                const siteLink = document.createElement('a');
                siteLink.href = targetUrl;
                siteLink.target = '_blank';
                siteLink.onclick = function(e) {
                    e.preventDefault();
                    window.open(targetUrl, '_blank');
                };
                siteLink.innerHTML = `
                    <div class="web-item">
                        <img src="${site.logo}" alt="${site.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPjwvc3ZnPg=='">
                        <div class="web-info">
                            <h3>${site.title}</h3>
                            <p>${site.desc || ''}</p>
                            <div class="url-info">
                                <span class="url-type" data-type="${urlType}">${urlType === 'internal' ? '内网' : urlType === 'backup' ? '备用' : '外网'}</span>
                                <span class="url-text">${targetUrl}</span>
                            </div>
                        </div>
                    </div>
                `;

                sectionHtml += `
                    <div class="col-sm-3">
                        <div class="xe-widget xe-conversations box2 label-info" onclick="window.open('${targetUrl}', '_blank')" data-toggle="tooltip" data-placement="bottom" title="${targetUrl}">
                            <div class="xe-comment-entry">
                                <a class="xe-user-img">
                                    <img data-src="${logoSrc || '../assets/images/favicon.png'}" class="lozad img-circle" width="40">
                                </a>
                                <div class="xe-comment">
                                    <a href="#" class="xe-user-name overflowClip_1">
                                        <strong>${site.title}</strong>
                                    </a>
                                    <p class="overflowClip_2">${site.desc}</p>
                                  
                                </div>
                            </div>
                        </div>
                    </div>`;
            });

            sectionHtml += '</div><br />'; // Close the last row for this section and add break
            return sectionHtml;
        }

        // --- 防抖函数 (如上一步添加) ---
        function debounce(func, wait, immediate) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                var later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        };

        // 网络类型本地存储相关函数
        function getStoredUrlType() {
            return localStorage.getItem('url_type') || 'main';
        }

        function setStoredUrlType(type) {
            localStorage.setItem('url_type', type);
        }


        function switchNetworkType(type) {
            setStoredUrlType(type);
            window.location.reload(); // 只刷新页面，不跳转参数
        }

        // 更新当前网络类型显示
        function updateNetworkTypeDisplay() {
            const urlType = getStoredUrlType();
            const displayText = urlType === 'internal' ? '内网' : urlType === 'backup' ? '备用' : '外网';
            // 修改按钮文字（保留图片）
            const btn = document.getElementById('current-network-type');
            if (btn) {
                // 只修改文本部分
                btn.textContent = ' ' + displayText;
            }
        }

        // 新增：根据url_type高亮active
        function updateNetworkTypeActive() {
            const urlType = getStoredUrlType();
            ['main', 'internal', 'backup'].forEach(type => {
                const li = document.getElementById('li-' + type);
                if (li) {
                    if (type === urlType) {
                        li.classList.add('active');
                    } else {
                        li.classList.remove('active');
                    }
                }
            });
        }
        document.addEventListener('DOMContentLoaded', function() {
            updateNetworkTypeDisplay();
            updateNetworkTypeActive();
        });

    </script>
    <!-- Bottom Scripts -->
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/TweenMax.min.js"></script>
    <script src="../assets/js/resizeable.js"></script>
    <script src="../assets/js/joinable.js"></script>
    <script src="../assets/js/xenon-api.js"></script>
    <script src="../assets/js/xenon-toggles.js"></script>
    <!-- JavaScripts initializations and stuff -->
    <script src="../assets/js/lozad.js"></script> <!-- Make sure Lozad is included -->
    <script src="../assets/js/xenon-custom.js"></script>

    <!-- PWA安装提示脚本 -->
    <script src="../assets/js/pwa-install.js"></script>

    <!-- 离线提示 -->
    <script>
        window.addEventListener('online', function() {
            document.body.classList.remove('offline');
            if(document.getElementById('offline-message')) {
                document.getElementById('offline-message').style.display = 'none';
            }
        });
        
        window.addEventListener('offline', function() {
            document.body.classList.add('offline');
            
            if(!document.getElementById('offline-message')) {
                const offlineMsg = document.createElement('div');
                offlineMsg.id = 'offline-message';
                offlineMsg.style.position = 'fixed';
                offlineMsg.style.top = '0';
                offlineMsg.style.left = '0';
                offlineMsg.style.right = '0';
                offlineMsg.style.backgroundColor = '#ff9800';
                offlineMsg.style.color = 'white';
                offlineMsg.style.padding = '10px';
                offlineMsg.style.textAlign = 'center';
                offlineMsg.style.zIndex = '10000';
                offlineMsg.innerHTML = '您当前处于离线状态，网站内容来自缓存';
                document.body.appendChild(offlineMsg);
            } else {
                document.getElementById('offline-message').style.display = 'block';
            }
        });
        
        // 检查初始网络状态
        if(!navigator.onLine) {
            window.dispatchEvent(new Event('offline'));
        }
    </script>
</body>

</html>